"use strict";(self.webpackChunkapito_website_v_2=self.webpackChunkapito_website_v_2||[]).push([[855,1423],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,ah:()=>s,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),h=o,g=u["".concat(p,".").concat(h)]||u[h]||c[h]||i;return n?a.createElement(g,r(r({ref:t},d),{},{components:n})):a.createElement(g,r({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var s=2;s<i;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},80923:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>p,toc:()=>d});var a=n(87462),o=(n(67294),n(3905)),i=n(67714);const r={sidebar_label:"iOS",title:"GraphQL API Integration with iOS Project"},l=void 0,p={unversionedId:"api-integration/graphql/integration-with-ios",id:"api-integration/graphql/integration-with-ios",title:"GraphQL API Integration with iOS Project",description:"Apollo gives a neat abstraction layer and an interface to your GraphQL server.",source:"@site/docs/api-integration/graphql/integration-with-ios.mdx",sourceDirName:"api-integration/graphql",slug:"/api-integration/graphql/integration-with-ios",permalink:"/docs/api-integration/graphql/integration-with-ios",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api-integration/graphql/integration-with-ios.mdx",tags:[],version:"current",frontMatter:{sidebar_label:"iOS",title:"GraphQL API Integration with iOS Project"},sidebar:"docs",previous:{title:"Android (Kotlin)",permalink:"/docs/api-integration/graphql/integration-with-android"},next:{title:"Flutter",permalink:"/docs/api-integration/graphql/integration-with-flutter"}},s={},d=[{value:"iOS Apollo Installation",id:"ios-apollo-installation",level:2},{value:"Adding a code generation build step",id:"adding-a-code-generation-build-step",level:3},{value:"Adding a schema file to your target directory",id:"adding-a-schema-file-to-your-target-directory",level:3},{value:"Build your target",id:"build-your-target",level:3},{value:"Adding the generated API file to your target",id:"adding-the-generated-api-file-to-your-target",level:3},{value:"Installing the Xcode add-ons to get syntax highlighting",id:"installing-the-xcode-add-ons-to-get-syntax-highlighting",level:3},{value:"Create .graphql files with your queries or mutations",id:"create-graphql-files-with-your-queries-or-mutations",level:3},{value:"Create apollo client",id:"create-apollo-client",level:3},{value:"Detailed Guide",id:"detailed-guide",level:2}],c={toc:d};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("head",null,(0,o.kt)("meta",{property:"og:type",content:"article"})),(0,o.kt)("p",null,"Apollo gives a neat abstraction layer and an interface to your GraphQL server.\nYou don't need to worry about constructing your queries with request body, headers and options, that you might have done with ",(0,o.kt)("inlineCode",{parentName:"p"},"AFNetworking")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"NWConnection")," say.\nYou can directly write queries and mutations in GraphQL, and they will automatically be sent to your server via your apollo client instance."),(0,o.kt)("h2",{id:"ios-apollo-installation"},"iOS Apollo Installation"),(0,o.kt)("p",null,"Let's get started by installing apollo client framework & peer graphql dependencies:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add github ",(0,o.kt)("inlineCode",{parentName:"li"},'"apollostack/apollo-ios"')," to your Cartfile."),(0,o.kt)("li",{parentName:"ul"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"carthage update")),(0,o.kt)("li",{parentName:"ul"},'Drag and drop Apollo.framework from the Carthage/Build/iOS folder to the "Linked Frameworks and Libraries" section of your application targets\' "General" settings tab'),(0,o.kt)("li",{parentName:"ul"},'On your application targets\u2019 "Build Phases" settings tab, click the "+" icon and choose "New Run Script Phase". Create a Run Script in which you specify your shell (ex: ',(0,o.kt)("inlineCode",{parentName:"li"},"bin/sh"),"), add the following contents to the script area below the shell:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"/usr/local/bin/carthage copy-frameworks\n")),(0,o.kt)("p",null,'and add the paths to the frameworks you want to use under "Input Files", e.g.:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"$(SRCROOT)/Carthage/Build/iOS/Apollo.framework\n")),(0,o.kt)("h3",{id:"adding-a-code-generation-build-step"},"Adding a code generation build step"),(0,o.kt)("p",null,"In order to invoke ",(0,o.kt)("inlineCode",{parentName:"p"},"apollo"),' as part of the Xcode build process, create a build step that runs before "Compile Sources".'),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},'On your application targets\u2019 "Build Phases" settings tab, click the "+" icon and choose "New Run Script Phase". Create a Run Script, change its name to "Generate Apollo GraphQL API" and drag it just above "Compile Sources". Then add the following contents to the script area below the shell:')),(0,o.kt)("p",null,"for iOS Project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'APOLLO_FRAMEWORK_PATH="$(eval find $FRAMEWORK_SEARCH_PATHS -name "Apollo.framework" -maxdepth 1)"\n\nif [ -z "$APOLLO_FRAMEWORK_PATH" ]; then\n  echo "error: Couldn\'t find Apollo.framework in FRAMEWORK_SEARCH_PATHS; make sure to add the framework to your project."\n  exit 1\nfi\n')),(0,o.kt)("p",null,"The script above will invoke ",(0,o.kt)("inlineCode",{parentName:"p"},"apollo")," through the ",(0,o.kt)("inlineCode",{parentName:"p"},"check-and-run-apollo-cli.sh")," wrapper script, which is actually contained in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Apollo.framework")," bundle. The main reason for this is to check whether the version of ",(0,o.kt)("inlineCode",{parentName:"p"},"apollo")," installed on your system is compatible with the framework version installed in your project, and to warn you if it isn't. Without this check, you could end up generating code that is incompatible with the runtime code contained in the framework."),(0,o.kt)("h3",{id:"adding-a-schema-file-to-your-target-directory"},"Adding a schema file to your target directory"),(0,o.kt)("p",null,"You'll have to copy or download a schema to your target directory before generating code."),(0,o.kt)("p",null,"Apollo iOS requires a GraphQL schema file as input to the code generation process. A schema file is a JSON file that contains the results of an an introspection query. Conventionally this file is called ",(0,o.kt)("inlineCode",{parentName:"p"},"schema.json")),(0,o.kt)("p",null,"To download ",(0,o.kt)("inlineCode",{parentName:"p"},"schema.json"),", you need to use the id_token from auth0 and run this in your terminal"),(0,o.kt)(i.default,{mdxType:"ApiSecretNote"}),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'apollo schema:download --endpoint=https://api.apito.io/secured/graphql --header="Authorization: Bearer API_SECRET"\n')),(0,o.kt)("h3",{id:"build-your-target"},"Build your target"),(0,o.kt)("p",null,"At this point, you can try building your target in Xcode. This will verify that the ",(0,o.kt)("inlineCode",{parentName:"p"},"schema.json")," file can be found by the ",(0,o.kt)("inlineCode",{parentName:"p"},"apollo")," script created above, otherwise you'll get a build error such as:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Cannot find GraphQL schema file ","[...]")),(0,o.kt)("h3",{id:"adding-the-generated-api-file-to-your-target"},"Adding the generated API file to your target"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Drag the generated ",(0,o.kt)("inlineCode",{parentName:"li"},"API.swift")," file to your target.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that because Apollo iOS generates query-specific result types, ",(0,o.kt)("inlineCode",{parentName:"p"},"API.swift")," will be mostly empty at this point unless you've already added some ",(0,o.kt)("inlineCode",{parentName:"p"},".graphql")," files with queries or mutations to your target directory.")),(0,o.kt)("h3",{id:"installing-the-xcode-add-ons-to-get-syntax-highlighting"},"Installing the Xcode add-ons to get syntax highlighting"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Clone the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/apollostack/xcode-apollo"},(0,o.kt)("inlineCode",{parentName:"a"},"xcode-apollo")," repository")," to your computer."),(0,o.kt)("li",{parentName:"ol"},"Close Xcode if it is currently running."),(0,o.kt)("li",{parentName:"ol"},"You may need to create these folders inside of ",(0,o.kt)("inlineCode",{parentName:"li"},"~/Library/Developer/Xcode"),":")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"mkdir ~/Library/Developer/Xcode/Plug-ins ~/Library/Developer/Xcode/Specifications")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Copy ",(0,o.kt)("inlineCode",{parentName:"li"},"GraphQL.ideplugin")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"~/Library/Developer/Xcode/Plug-ins"),".")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cp -R GraphQL.ideplugin ~/Library/Developer/Xcode/Plug-ins")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Copy ",(0,o.kt)("inlineCode",{parentName:"li"},"GraphQL.xclangspec")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"~/Library/Developer/Xcode/Specifications"),".")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cp -R GraphQL.xclangspec ~/Library/Developer/Xcode/Specifications")),(0,o.kt)("p",null,"You may receive a warning when you first start up Xcode after installing these add-ons."),(0,o.kt)("h3",{id:"create-graphql-files-with-your-queries-or-mutations"},"Create .graphql files with your queries or mutations"),(0,o.kt)("p",null,"Apollo iOS generates code from queries and mutations contained in ",(0,o.kt)("inlineCode",{parentName:"p"},".graphql")," files in your target."),(0,o.kt)("p",null,"A useful convention is to colocate queries, mutations or fragments with the Swift code that uses them by creating ",(0,o.kt)("inlineCode",{parentName:"p"},"<name>.graphql")," next to ",(0,o.kt)("inlineCode",{parentName:"p"},"<name>.swift"),"."),(0,o.kt)("p",null,"If you have the Xcode add-ons installed, you can use the Xcode companion view to show a ",(0,o.kt)("inlineCode",{parentName:"p"},".swift")," file and the corresponding ",(0,o.kt)("inlineCode",{parentName:"p"},".graphql")," file side by side."),(0,o.kt)("h3",{id:"create-apollo-client"},"Create apollo client"),(0,o.kt)("p",null,"Open LoginVC.swift and add below"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'case .success(let credentials):\n                    if(!SessionManager.shared.store(credentials: credentials)) {\n                        print("Failed to store credentials")\n                    } else {\n                        SessionManager.shared.retrieveProfile { error in\n                            DispatchQueue.main.async {\n                                guard error == nil else {\n                                    print("Failed to retrieve profile: \\(String(describing: error))")\n                                    return self.showLoginWithPatch()\n                                }\n+                               NetworkManager.shared.setApolloClient(accessToken: credentials.idToken!)\n                                self.dismiss(animated: true, completion: nil)\n                            }\n                        }\n                    }\n                }\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'DispatchQueue.main.async {\n                    SessionManager.shared.retrieveProfile { error in\n                        DispatchQueue.main.async {\n                            guard error == nil else {\n                                print("Failed to retrieve profile: \\(String(describing: error))")\n                                return callback()\n                            }\n+                            NetworkManager.shared.setApolloClient(accessToken: (SessionManager.shared.credentials?.idToken!)!)\n                            self.dismiss(animated: true, completion: nil)\n                        }\n                    }\n                }\n')),(0,o.kt)("p",null,"We are passing our tokenID to be set in apollo client so that we can make authorised calls to our graphql backend. Now let's create this file which will return apollo client with httplink and cache. Lets call this file 'NetworkManager.swift`"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Always remember to replace ",(0,o.kt)("inlineCode",{parentName:"p"},"API_SECRET")," with the correct value that you copied from apito console.\nGo to ",(0,o.kt)("a",{parentName:"p",href:"/docs/console/api-integration-with-your-application"},"this page")," if you do not know where to find your api secrets for your project")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},'import Foundation\nimport Apollo\nimport ApolloWebSocket\n\nclass NetworkManager {\n    static let shared = NetworkManager()\n    let graphEndpoint = "https://api.apito.io/secured/graphql"\n    var apolloClient : ApolloClient?\n\n    private init (){\n    }\n\n    func setApolloClient(accessToken: String){\n        self.apolloClient = {\n            let authPayloads = ["Authorization": "Bearer API_SECRET"]\n            let configuration = URLSessionConfiguration.default\n            configuration.httpAdditionalHeaders = authPayloads\n            let endpointURL = URL(string: graphEndpoint)!\n\n            return ApolloClient(networkTransport: HTTPNetworkTransport(url: endpointURL, configuration: configuration))\n            }()\n    }\n\n}\n\n')),(0,o.kt)("h2",{id:"detailed-guide"},"Detailed Guide"),(0,o.kt)("p",null,"For an alternate and detailed guide, be sure to check out the official apollo guide ",(0,o.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/ios/"},"here")))}u.isMDXComponent=!0},67714:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(87462),o=(n(67294),n(3905));const i={},r=void 0,l={unversionedId:"api-integration/graphql/shared/api-secret-note",id:"api-integration/graphql/shared/api-secret-note",title:"api-secret-note",description:"Always remember to replace API_SECRET with the correct value that you copied from apito console.",source:"@site/docs/api-integration/graphql/shared/api-secret-note.mdx",sourceDirName:"api-integration/graphql/shared",slug:"/api-integration/graphql/shared/api-secret-note",permalink:"/docs/api-integration/graphql/shared/api-secret-note",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api-integration/graphql/shared/api-secret-note.mdx",tags:[],version:"current",frontMatter:{}},p={},s=[],d={toc:s};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Always remember to replace ",(0,o.kt)("inlineCode",{parentName:"p"},"API_SECRET")," with the correct value that you copied from apito console.\nGo to ",(0,o.kt)("a",{parentName:"p",href:"/docs/console/api-integration-with-your-application"},"this page")," if you do not know where to find your api secrets for your project")))}c.isMDXComponent=!0}}]);